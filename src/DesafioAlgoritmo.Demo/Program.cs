using DesafioAlgoritmo.Core.Algoritmos;
using DesafioAlgoritmo.Core.Concorrencia;
using DesafioAlgoritmo.Core.Observabilidade;
using DesafioAlgoritmo.Core.Servicos;
using DesafioAlgoritmo.Infraestrutura.Persistencia;
using DesafioAlgoritmo.Infrastructure.Http;
using Microsoft.EntityFrameworkCore;
using Microsoft.Extensions.DependencyInjection;
using Microsoft.Extensions.Logging;

Console.OutputEncoding = System.Text.Encoding.UTF8;

var serviceProvider = ConfigurarServicos();

ILogger ObterLoggerPorCategoria(string categoria) => serviceProvider.GetRequiredService<ILoggerFactory>().CreateLogger(categoria);
MetricasAplicacao ObterMetricas() => serviceProvider.GetRequiredService<MetricasAplicacao>();

ServiceProvider ConfigurarServicos()
{
    var services = new ServiceCollection();

    services.AddLogging(builder =>
    {
        builder.AddConsole();
        builder.SetMinimumLevel(LogLevel.Information);
    });

    services.AddSingleton<MetricasAplicacao>(sp => new MetricasAplicacao("DesafioAlgoritmo.Demo"));

    services.AddScoped<ProcessadorParalelo>();
    services.AddScoped<OrquestradorDependencias>();

    services.AddDbContext<ContextoBdRegistroTrabalho>(options =>
        options.UseInMemoryDatabase("DemoInterativa"));

    services.AddScoped<IRepositorioRegistroTrabalho, RepositorioRegistroTrabalho>();

    services.AddHttpClient<ClienteHttpResistente>()
        .ConfigurePrimaryHttpMessageHandler(() => new HttpClientHandler
        {
            ServerCertificateCustomValidationCallback = (message, cert, chain, errors) => true
        });

    services.AddScoped<ClienteHttpResistente>(sp =>
    {
        var httpClient = sp.GetRequiredService<IHttpClientFactory>().CreateClient(nameof(ClienteHttpResistente));
        var logger = sp.GetRequiredService<ILogger<ClienteHttpResistente>>();
        var metricas = sp.GetRequiredService<MetricasAplicacao>();
        return new ClienteHttpResistente(httpClient, logger, metricas);
    });

    return services.BuildServiceProvider();
}

bool continuar = true;

while (continuar)
{
    MostrarMenuPrincipal();
    var opcao = DesafioAlgoritmo.Demo.InterfaceConsole.LerOpcao(1, 7);

    Console.Clear();

    switch (opcao)
    {
        case 1:
            await TestarPrimeiroRepetido();
            break;
        case 2:
            TestarMaiorSequenciaCrescente();
            break;
        case 3:
            await TestarProcessamentoParalelo();
            break;
        case 4:
            await TestarOrquestrador();
            break;
        case 5:
            await TestarPersistencia();
            break;
        case 6:
            await TestarClienteHttpResiliente();
            break;
        case 7:
            continuar = false;
            Console.WriteLine("\nüëã At√© logo! Obrigado por testar o Desafio de Algoritmos!");
            break;
    }

    if (continuar)
    {
        Console.WriteLine("\n\nPressione qualquer tecla para voltar ao menu...");
        Console.ReadKey(true);
        Console.Clear();
    }
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// FUN√á√ïES DE TESTE
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

async Task TestarPrimeiroRepetido()
{
    Console.WriteLine("‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó");
    Console.WriteLine("‚ïë     SE√á√ÉO 1.1 - PRIMEIRO N√öMERO REPETIDO                 ‚ïë");
    Console.WriteLine("‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù\n");

    Console.WriteLine("üìù Este algoritmo encontra o primeiro n√∫mero que aparece");
    Console.WriteLine("   duas vezes em uma sequ√™ncia, respeitando a ordem.\n");

    Console.WriteLine("üí° COMPLEXIDADE:");
    Console.WriteLine("   ‚Ä¢ Tempo: O(n) - percorre a lista uma vez");
    Console.WriteLine("   ‚Ä¢ Espa√ßo: O(n) - usa HashSet para guardar n√∫meros vistos\n");

    while (true)
    {
        Console.WriteLine("‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ");
        Console.WriteLine("Escolha uma op√ß√£o:");
        Console.WriteLine("  1 - Usar exemplo pronto");
        Console.WriteLine("  2 - Digitar seus pr√≥prios n√∫meros");
        Console.WriteLine("  0 - Voltar ao menu");
        Console.Write("\nSua escolha: ");

        if (!int.TryParse(Console.ReadLine(), out int escolha))
        {
            DesafioAlgoritmo.Demo.InterfaceConsole.MostrarErro("Op√ß√£o inv√°lida! Digite um n√∫mero.");
            continue;
        }

        if (escolha == 0) return;

        long[] numeros;

        if (escolha == 1)
        {
            numeros = new long[] { 4, 7, 2, 9, 2, 5, 7, 3 };
            Console.WriteLine($"\n‚úÖ Usando exemplo: [{string.Join(", ", numeros)}]");
        }
        else if (escolha == 2)
        {
            numeros = DesafioAlgoritmo.Demo.InterfaceConsole.LerArrayDeInteiros();
            if (numeros.Length == 0) continue;
        }
        else
        {
            DesafioAlgoritmo.Demo.InterfaceConsole.MostrarErro("Op√ß√£o inv√°lida!");
            continue;
        }

        Console.WriteLine("\n‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó");
        Console.ForegroundColor = ConsoleColor.Cyan;
        Console.WriteLine("‚ïë  üîç OBSERVABILIDADE ATIVA                                 ‚ïë");
        Console.ResetColor();
        Console.WriteLine("‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù");
        Console.WriteLine("üìä M√©tricas sendo coletadas:");
        Console.WriteLine("   ‚Ä¢ Tempo de execu√ß√£o do algoritmo");
        Console.WriteLine("   ‚Ä¢ Correla√ß√£o via OperationId");
        Console.WriteLine();

        using var contexto = ContextoOperacao.IniciarOperacao();
        var logger = ObterLoggerPorCategoria("AnalisadorSequencia");
        var metricas = ObterMetricas();
        var cronometro = System.Diagnostics.Stopwatch.StartNew();

        logger.RegistrarInformacaoComContexto("Processando array de {Tamanho} elementos", numeros.Length);
        Console.WriteLine("üîÑ Processando...\n");

        var resultado = AnalisadorSequencia.EncontrarPrimeiroRepetido(numeros);

        cronometro.Stop();
        logger.RegistrarInformacaoComContexto("Processamento conclu√≠do em {DuracaoMs}ms", cronometro.ElapsedMilliseconds);
        metricas.RegistrarOperacao("AnalisadorSequencia.EncontrarPrimeiroRepetido", cronometro.Elapsed);

        Console.WriteLine("‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê");
        if (resultado.HasValue)
        {
            Console.WriteLine($"‚úÖ RESULTADO: {resultado.Value}");

            var primeiraPos = Array.IndexOf(numeros, resultado.Value);
            var segundaPos = Array.IndexOf(numeros, resultado.Value, primeiraPos + 1);

            Console.WriteLine($"\nüìç Primeira apari√ß√£o: √≠ndice {primeiraPos} (elemento {primeiraPos + 1} de {numeros.Length})");
            Console.WriteLine($"üìç Segunda apari√ß√£o: √≠ndice {segundaPos} (elemento {segundaPos + 1} de {numeros.Length})");

            Console.WriteLine("\nüìä Visualiza√ß√£o do array:");

            var maxWidth = Math.Max(4, numeros.Max(n => n.ToString().Length));

            Console.Write("   √çndices:  ");
            for (int i = 0; i < numeros.Length; i++)
            {
                Console.Write($"[{i}]".PadRight(maxWidth + 1));
            }
            Console.WriteLine();

            Console.Write("   Valores:  ");
            for (int i = 0; i < numeros.Length; i++)
            {
                if (i == primeiraPos || i == segundaPos)
                {
                    Console.ForegroundColor = ConsoleColor.Yellow;
                    Console.Write(numeros[i].ToString().PadRight(maxWidth + 1));
                    Console.ResetColor();
                }
                else
                {
                    Console.Write(numeros[i].ToString().PadRight(maxWidth + 1));
                }
            }
            Console.WriteLine();

            Console.Write("   Marca√ß√£o: ");
            for (int i = 0; i < numeros.Length; i++)
            {
                if (i == primeiraPos)
                {
                    Console.ForegroundColor = ConsoleColor.Yellow;
                    Console.Write("‚ñ≤1¬∞".PadRight(maxWidth + 1));
                    Console.ResetColor();
                }
                else if (i == segundaPos)
                {
                    Console.ForegroundColor = ConsoleColor.Yellow;
                    Console.Write("‚ñ≤2¬∞".PadRight(maxWidth + 1));
                    Console.ResetColor();
                }
                else
                {
                    Console.Write(new string(' ', maxWidth + 1));
                }
            }
            Console.WriteLine();
            Console.WriteLine($"\nüí° O n√∫mero {resultado.Value} √© o primeiro que se repete no array!");
        }
        else
        {
            Console.WriteLine("‚ÑπÔ∏è  RESULTADO: Nenhum n√∫mero repetido encontrado");
            Console.WriteLine("\nüí° Todos os n√∫meros s√£o √∫nicos na sequ√™ncia!");
        }

        Console.WriteLine();
        Console.ForegroundColor = ConsoleColor.Cyan;
        Console.WriteLine("üìà M√âTRICAS REGISTRADAS:");
        Console.ResetColor();
        Console.WriteLine($"   ‚úÖ Opera√ß√£o: AnalisadorSequencia.EncontrarPrimeiroRepetido");
        Console.WriteLine($"   ‚è±Ô∏è  Dura√ß√£o: {cronometro.ElapsedMilliseconds}ms");
        Console.WriteLine($"   üìä Array tamanho: {numeros.Length}");
        Console.WriteLine($"   üîó OperationId: {ContextoOperacao.Atual?.IdOperacao}");
        Console.ForegroundColor = ConsoleColor.Green;
        Console.WriteLine("üí° Veja os logs acima - todos t√™m [IdOperacao=...] para correla√ß√£o!");
        Console.ResetColor();
        Console.WriteLine("‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n");

        Console.Write("Testar outro array? (s/n): ");
        if (Console.ReadLine()?.ToLower() != "s") break;
        Console.WriteLine();
    }
}

void TestarMaiorSequenciaCrescente()
{
    Console.WriteLine("‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó");
    Console.WriteLine("‚ïë     SE√á√ÉO 1.2 - MAIOR SEQU√äNCIA CRESCENTE                ‚ïë");
    Console.WriteLine("‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù\n");

    Console.WriteLine("üìù Este algoritmo encontra a maior sequ√™ncia de n√∫meros");
    Console.WriteLine("   onde cada um √© maior que o anterior.\n");

    Console.WriteLine("üí° COMPLEXIDADE:");
    Console.WriteLine("   ‚Ä¢ Tempo: O(n) - percorre a lista uma vez");
    Console.WriteLine("   ‚Ä¢ Espa√ßo: O(1) - s√≥ guarda √≠ndices e tamanhos\n");

    while (true)
    {
        Console.WriteLine("‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ");
        Console.WriteLine("Escolha uma op√ß√£o:");
        Console.WriteLine("  1 - Usar exemplo pronto");
        Console.WriteLine("  2 - Digitar seus pr√≥prios n√∫meros");
        Console.WriteLine("  0 - Voltar ao menu");
        Console.Write("\nSua escolha: ");

        if (!int.TryParse(Console.ReadLine(), out int escolha))
        {
            DesafioAlgoritmo.Demo.InterfaceConsole.MostrarErro("Op√ß√£o inv√°lida! Digite um n√∫mero.");
            continue;
        }

        if (escolha == 0) return;

        long[] numeros;

        if (escolha == 1)
        {
            numeros = new long[] { 1, 2, 5, 3, 4, 5, 6, 7, 2 };
            Console.WriteLine($"\n‚úÖ Usando exemplo: [{string.Join(", ", numeros)}]");
        }
        else if (escolha == 2)
        {
            numeros = DesafioAlgoritmo.Demo.InterfaceConsole.LerArrayDeInteiros();
            if (numeros.Length == 0) continue;
        }
        else
        {
            DesafioAlgoritmo.Demo.InterfaceConsole.MostrarErro("Op√ß√£o inv√°lida!");
            continue;
        }

        Console.WriteLine("\n‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó");
        Console.ForegroundColor = ConsoleColor.Cyan;
        Console.WriteLine("‚ïë  üîç OBSERVABILIDADE ATIVA                                 ‚ïë");
        Console.ResetColor();
        Console.WriteLine("‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù");
        Console.WriteLine("üìä M√©tricas sendo coletadas:");
        Console.WriteLine("   ‚Ä¢ Tempo de execu√ß√£o do algoritmo");
        Console.WriteLine("   ‚Ä¢ Correla√ß√£o via OperationId");
        Console.WriteLine();

        using var contexto = ContextoOperacao.IniciarOperacao();
        var loggerSequencia = ObterLoggerPorCategoria("AnalisadorSequencia");
        var metricasSequencia = ObterMetricas();
        var cronometro = System.Diagnostics.Stopwatch.StartNew();

        loggerSequencia.RegistrarInformacaoComContexto("Processando array de {Tamanho} elementos", numeros.Length);
        Console.WriteLine("üîÑ Processando...\n");

        var resultado = AnalisadorSequencia.EncontrarMaiorSubsequenciaConsecutiva(numeros);

        cronometro.Stop();
        loggerSequencia.RegistrarInformacaoComContexto("Processamento conclu√≠do em {DuracaoMs}ms. Sequ√™ncia encontrada: {Tamanho} elementos", cronometro.ElapsedMilliseconds, resultado.Count);
        metricasSequencia.RegistrarOperacao("AnalisadorSequencia.EncontrarMaiorSubsequenciaConsecutiva", cronometro.Elapsed);

        Console.WriteLine("‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê");
        Console.WriteLine($"‚úÖ MAIOR SEQU√äNCIA CRESCENTE: [{string.Join(", ", resultado)}]");
        Console.WriteLine($"üìä Tamanho: {resultado.Count} elemento(s)");

        if (resultado.Count > 0)
        {
            var posicaoInicio = Array.IndexOf(numeros, resultado[0]);
            if (posicaoInicio >= 0)
            {
                var posicaoFim = posicaoInicio + resultado.Count - 1;
                Console.WriteLine($"üìç Posi√ß√£o no array: √≠ndice {posicaoInicio} at√© {posicaoFim} (elementos {posicaoInicio + 1}-{posicaoFim + 1} de {numeros.Length})");

                Console.WriteLine("\nüìä Visualiza√ß√£o do array:");

                var maxWidth = Math.Max(4, numeros.Max(n => n.ToString().Length));

                Console.Write("   √çndices:  ");
                for (int i = 0; i < numeros.Length; i++)
                {
                    Console.Write($"[{i}]".PadRight(maxWidth + 1));
                }
                Console.WriteLine();

                Console.Write("   Valores:  ");
                for (int i = 0; i < numeros.Length; i++)
                {
                    if (i >= posicaoInicio && i <= posicaoFim)
                    {
                        Console.ForegroundColor = ConsoleColor.Green;
                        Console.Write(numeros[i].ToString().PadRight(maxWidth + 1));
                        Console.ResetColor();
                    }
                    else
                    {
                        Console.Write(numeros[i].ToString().PadRight(maxWidth + 1));
                    }
                }
                Console.WriteLine();

                Console.Write("   Marca√ß√£o: ");
                for (int i = 0; i < numeros.Length; i++)
                {
                    if (i >= posicaoInicio && i <= posicaoFim)
                    {
                        Console.ForegroundColor = ConsoleColor.Green;
                        Console.Write("‚ñ≤‚ñ≤‚ñ≤".PadRight(maxWidth + 1));
                        Console.ResetColor();
                    }
                    else
                    {
                        Console.Write(new string(' ', maxWidth + 1));
                    }
                }
                Console.WriteLine();
            }
        }

        if (resultado.Count > 1)
        {
            Console.WriteLine($"\nüí° Sequ√™ncia consecutiva onde cada n√∫mero = anterior + 1");
            Console.WriteLine($"   Exemplo: {resultado[0]} ‚Üí {resultado[1]}" +
                (resultado.Count > 2 ? $" ‚Üí {resultado[2]}..." : ""));
        }

        Console.WriteLine();
        Console.ForegroundColor = ConsoleColor.Cyan;
        Console.WriteLine("üìà M√âTRICAS REGISTRADAS:");
        Console.ResetColor();
        Console.WriteLine($"   ‚úÖ Opera√ß√£o: AnalisadorSequencia.EncontrarMaiorSubsequenciaConsecutiva");
        Console.WriteLine($"   ‚è±Ô∏è  Dura√ß√£o: {cronometro.ElapsedMilliseconds}ms");
        Console.WriteLine($"   üìä Array tamanho: {numeros.Length}");
        Console.WriteLine($"   üìà Sequ√™ncia encontrada: {resultado.Count} elementos");
        Console.WriteLine($"   üîó OperationId: {ContextoOperacao.Atual?.IdOperacao}");
        Console.ForegroundColor = ConsoleColor.Green;
        Console.WriteLine("üí° Veja os logs acima - todos t√™m [IdOperacao=...] para correla√ß√£o!");
        Console.ResetColor();
        Console.WriteLine("‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n");

        Console.Write("Testar outro array? (s/n): ");
        if (Console.ReadLine()?.ToLower() != "s") break;
        Console.WriteLine();
    }
}

async Task TestarProcessamentoParalelo()
{
    Console.WriteLine("‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó");
    Console.WriteLine("‚ïë     SE√á√ÉO 2 - PROCESSAMENTO PARALELO                     ‚ïë");
    Console.WriteLine("‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù\n");

    Console.WriteLine("üìù Processa milhares de itens em paralelo de forma segura");
    Console.WriteLine("   (thread-safe) usando ConcurrentDictionary.\n");

    Console.WriteLine("üí° SEGURAN√áA:");
    Console.WriteLine("   ‚Ä¢ ConcurrentDictionary: opera√ß√µes at√¥micas lock-free");
    Console.WriteLine("   ‚Ä¢ Interlocked.Increment: contador thread-safe");
    Console.WriteLine("   ‚Ä¢ Sem race conditions!\n");

    Console.Write("Quantos itens processar (ex: 1000, 5000, 10000)? ");
    if (!int.TryParse(Console.ReadLine(), out int quantidade) || quantidade <= 0)
    {
        DesafioAlgoritmo.Demo.InterfaceConsole.MostrarErro("Quantidade inv√°lida!");
        return;
    }

    Console.Write("Grau de paralelismo (1-8, recomendado 4): ");
    if (!int.TryParse(Console.ReadLine(), out int paralelismo) || paralelismo < 1 || paralelismo > 8)
    {
        paralelismo = 4;
        Console.WriteLine($"Usando padr√£o: {paralelismo}");
    }

    using var scope = serviceProvider.CreateScope();
    var processor = scope.ServiceProvider.GetRequiredService<ProcessadorParalelo>();

    Console.WriteLine("\n‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó");
    Console.ForegroundColor = ConsoleColor.Cyan;
    Console.WriteLine("‚ïë  üîç OBSERVABILIDADE ATIVA                                 ‚ïë");
    Console.ResetColor();
    Console.WriteLine("‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù");
    Console.WriteLine("üìä M√©tricas sendo coletadas:");
    Console.WriteLine("   ‚Ä¢ Tempo de processamento");
    Console.WriteLine("   ‚Ä¢ Taxa de sucesso/erro");
    Console.WriteLine("   ‚Ä¢ Correla√ß√£o via OperationId");
    Console.WriteLine();

    // üé® Cria itens com nomes variados para melhor visualiza√ß√£o das categorias
    var nomesItens = new[]
    {
        "Apple", "Banana", "Cherry", "Dragon Fruit", "Elderberry",
        "Fig", "Grape", "Honeydew", "Iceberg Lettuce", "Jackfruit",
        "Kiwi", "Lemon", "Mango", "Nectarine", "Orange",
        "Papaya", "Quince", "Raspberry", "Strawberry", "Tangerine",
        "Ugli Fruit", "Vanilla", "Watermelon", "Xigua", "Yellow Squash", "Zucchini"
    };

    var items = Enumerable.Range(0, quantidade)
        .Select(i => nomesItens[i % nomesItens.Length])
        .ToList();

    // Mostra preview dos primeiros itens
    Console.WriteLine($"\nüì¶ Exemplos de itens que ser√£o processados:");
    Console.WriteLine($"   {string.Join(", ", items.Take(10))}...\n");

    // üî¥ Pergunta se quer testar cancelamento
    Console.Write("Deseja testar CANCELAMENTO durante o processamento? (s/n): ");
    var testarCancelamento = Console.ReadLine()?.ToLower() == "s";

    var cts = new CancellationTokenSource();
    var options = new OpcoesProcessadorParalelo
    {
        GrauMaximoParalelismo = paralelismo,
        CancellationToken = cts.Token
    };

    if (testarCancelamento)
    {
        Console.Write("Cancelar ap√≥s quantos segundos? (ex: 2, 5, 10): ");
        if (int.TryParse(Console.ReadLine(), out int segundos) && segundos > 0)
        {
            cts.CancelAfter(TimeSpan.FromSeconds(segundos));
            Console.WriteLine($"\n‚è∞ ATEN√á√ÉO: O processamento ser√° CANCELADO ap√≥s {segundos} segundo(s)!\n");
        }
        else
        {
            Console.WriteLine("\nüí° Voc√™ tamb√©m pode pressionar CTRL+C para cancelar manualmente!\n");
        }
    }

    Console.WriteLine($"üîÑ Processando {quantidade} itens com {paralelismo} threads...");
    if (testarCancelamento)
    {
        Console.WriteLine($"üî¥ Modo cancelamento ATIVO - aguardando interrup√ß√£o...\n");
    }
    else
    {
        Console.WriteLine();
    }

    ResultadoProcessamento resultado;
    try
    {
        resultado = await processor.ProcessarAsync(items, options);
    }
    finally
    {
        cts.Dispose();
    }

    Console.WriteLine("\n‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê");

    if (resultado.FoiCancelado)
    {
        Console.ForegroundColor = ConsoleColor.Yellow;
        Console.WriteLine("‚ö†Ô∏è  PROCESSAMENTO CANCELADO!");
        Console.ResetColor();
        Console.WriteLine($"üìä Progresso antes do cancelamento: {resultado.TotalProcessado}/{quantidade} itens ({(resultado.TotalProcessado * 100.0 / quantidade):F1}%)");
        Console.WriteLine($"‚è±Ô∏è  Tempo at√© cancelamento: {resultado.TempoProcessamento.TotalMilliseconds:F2}ms");
        Console.WriteLine($"\nüí° Os resultados parciais foram salvos com sucesso!");
    }
    else
    {
        Console.ForegroundColor = ConsoleColor.Green;
        Console.WriteLine("‚úÖ PROCESSAMENTO COMPLETO!");
        Console.ResetColor();
        Console.WriteLine($"üìä Total processado: {resultado.TotalProcessado} itens");
        Console.WriteLine($"‚è±Ô∏è  Tempo gasto: {resultado.TempoProcessamento.TotalMilliseconds:F2}ms");
        Console.WriteLine($"‚ö° Velocidade: {(resultado.TotalProcessado / resultado.TempoProcessamento.TotalSeconds):F0} itens/segundo");
    }

    Console.WriteLine($"\nüìä Categorias processadas: {resultado.ContagemPorCategoria.Count} letras diferentes");
    Console.WriteLine($"‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ");

    foreach (var cat in resultado.ContagemPorCategoria.OrderBy(x => x.Key))
    {
        var porcentagem = resultado.TotalProcessado > 0
            ? (cat.Value * 100.0 / resultado.TotalProcessado)
            : 0;
        var barra = new string('‚ñà', (int)(porcentagem / 2)); // Barra visual
        Console.WriteLine($"   {cat.Key} ‚îÇ{barra,-50}‚îÇ {cat.Value,5} itens ({porcentagem:F1}%)");
    }
    Console.WriteLine("‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê");

    Console.WriteLine();
    Console.ForegroundColor = ConsoleColor.Cyan;
    Console.WriteLine("üìà M√âTRICAS REGISTRADAS:");
    Console.ResetColor();
    Console.WriteLine($"   ‚úÖ Opera√ß√£o: ProcessadorParalelo.ProcessarAsync");
    Console.WriteLine($"   ‚è±Ô∏è  Dura√ß√£o: {resultado.TempoProcessamento.TotalMilliseconds:F2}ms");
    Console.WriteLine($"   üìä Status: {(resultado.FoiCancelado ? "Cancelado" : "Sucesso")}");
    Console.WriteLine($"   üîó Logs com correla√ß√£o via OperationId");
    Console.WriteLine();
    Console.ForegroundColor = ConsoleColor.Green;
    Console.WriteLine("üí° Veja os logs acima - todos t√™m [IdOperacao=...] para correla√ß√£o!");
    Console.ResetColor();
    Console.WriteLine("‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê");
}

async Task TestarOrquestrador()
{
    Console.WriteLine("‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó");
    Console.WriteLine("‚ïë     SE√á√ÉO 3 - TRATAMENTO DE ERROS                        ‚ïë");
    Console.WriteLine("‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù\n");

    Console.WriteLine("üìù Orquestra chamadas a m√∫ltiplos servi√ßos externos.");
    Console.WriteLine("   Se um falha, continua chamando os outros!\n");

    Console.WriteLine("üí° ESTRAT√âGIA:");
    Console.WriteLine("   ‚Ä¢ Isolamento de falhas");
    Console.WriteLine("   ‚Ä¢ Respostas parciais sempre dispon√≠veis");
    Console.WriteLine("   ‚Ä¢ Consumidor recebe m√°ximo de dados poss√≠vel\n");

    Console.Write("Quantos servi√ßos simular (1-5)? ");
    if (!int.TryParse(Console.ReadLine(), out int numServicos) || numServicos < 1 || numServicos > 5)
    {
        numServicos = 3;
        Console.WriteLine($"Usando padr√£o: {numServicos}");
    }

    var dependencies = new List<IDependenciaExterna>();

    Console.WriteLine($"\nConfigurando {numServicos} servi√ßos:");
    for (int i = 1; i <= numServicos; i++)
    {
        Console.Write($"  Servi√ßo {i} deve falhar? (s/n): ");
        var deveFalhar = Console.ReadLine()?.ToLower() == "s";
        dependencies.Add(new DesafioAlgoritmo.Demo.MockDependenciaExterna($"Servico{i}", deveFalhar));
        Console.WriteLine($"    ‚úÖ Servico{i} configurado para " + (deveFalhar ? "FALHAR ‚ùå" : "SUCESSO ‚úÖ"));
    }

    using var scope = serviceProvider.CreateScope();
    var orchestrator = scope.ServiceProvider.GetRequiredService<OrquestradorDependencias>();

    Console.WriteLine("\n‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó");
    Console.ForegroundColor = ConsoleColor.Cyan;
    Console.WriteLine("‚ïë  üîç OBSERVABILIDADE ATIVA                                 ‚ïë");
    Console.ResetColor();
    Console.WriteLine("‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù");
    Console.WriteLine("üìä M√©tricas sendo coletadas:");
    Console.WriteLine("   ‚Ä¢ Tempo de processamento por servi√ßo");
    Console.WriteLine("   ‚Ä¢ Taxa de sucesso/erro por depend√™ncia");
    Console.WriteLine("   ‚Ä¢ Correla√ß√£o via OperationId");
    Console.WriteLine();

    Console.WriteLine("üîÑ Executando orquestra√ß√£o...\n");
    var resultado = await orchestrator.ExecutarAsync(dependencies);

    Console.WriteLine("\n‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê");
    Console.WriteLine($"üìä SUM√ÅRIO: {resultado.ObterResumo()}");
    Console.WriteLine($"\n‚úÖ Sucessos ({resultado.RespostasComSucesso.Count}):");
    foreach (var success in resultado.RespostasComSucesso)
    {
        Console.WriteLine($"   ‚Ä¢ {success.Key}: {success.Value}");
    }

    if (resultado.Falhas.Count > 0)
    {
        Console.WriteLine($"\n‚ùå Falhas ({resultado.Falhas.Count}):");
        foreach (var failure in resultado.Falhas)
        {
            Console.WriteLine($"   ‚Ä¢ {failure.Key}: {failure.Value}");
        }
    }

    Console.WriteLine("\nüí° Mesmo com falhas parciais, os dados dos servi√ßos que");
    Console.WriteLine("   funcionaram foram retornados com sucesso!");

    Console.WriteLine();
    Console.ForegroundColor = ConsoleColor.Cyan;
    Console.WriteLine("üìà M√âTRICAS REGISTRADAS:");
    Console.ResetColor();
    Console.WriteLine($"   ‚úÖ Opera√ß√£o: OrquestradorDependencias.ExecutarAsync");
    Console.WriteLine($"   üìä Total de depend√™ncias: {numServicos}");
    Console.WriteLine($"   ‚úÖ Sucessos: {resultado.RespostasComSucesso.Count}");
    Console.WriteLine($"   ‚ùå Falhas: {resultado.Falhas.Count}");
    Console.WriteLine($"   üîó Logs com correla√ß√£o via OperationId");
    Console.ForegroundColor = ConsoleColor.Green;
    Console.WriteLine("üí° Veja os logs acima - todos t√™m [IdOperacao=...] para correla√ß√£o!");
    Console.ResetColor();
    Console.WriteLine("‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê");
}

async Task TestarPersistencia()
{
    Console.WriteLine("‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó");
    Console.WriteLine("‚ïë     SE√á√ÉO 4 - PERSIST√äNCIA (EF CORE)                     ‚ïë");
    Console.WriteLine("‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù\n");

    Console.WriteLine("üìù Demonstra opera√ß√µes CRUD com Entity Framework Core");
    Console.WriteLine("   usando banco de dados InMemory.\n");

    using var scope = serviceProvider.CreateScope();
    var repository = scope.ServiceProvider.GetRequiredService<IRepositorioRegistroTrabalho>();

    Console.WriteLine("‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó");
    Console.ForegroundColor = ConsoleColor.Cyan;
    Console.WriteLine("‚ïë  üîç OBSERVABILIDADE ATIVA                                 ‚ïë");
    Console.ResetColor();
    Console.WriteLine("‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù");
    Console.WriteLine("üìä M√©tricas sendo coletadas:");
    Console.WriteLine("   ‚Ä¢ Tempo de cada opera√ß√£o CRUD");
    Console.WriteLine("   ‚Ä¢ Performance de queries EF Core");
    Console.WriteLine("   ‚Ä¢ Correla√ß√£o via OperationId");
    Console.ForegroundColor = ConsoleColor.Green;
    Console.WriteLine("üí° Cada opera√ß√£o abaixo ter√° suas m√©tricas registradas!");
    Console.ResetColor();
    Console.WriteLine();

    while (true)
    {
        Console.WriteLine("‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ");
        Console.WriteLine("Opera√ß√µes dispon√≠veis:");
        Console.WriteLine("  1 - Criar novo registro");
        Console.WriteLine("  2 - Listar todos os registros");
        Console.WriteLine("  3 - Buscar por status");
        Console.WriteLine("  4 - Atualizar registro");
        Console.WriteLine("  5 - Deletar registro");
        Console.WriteLine("  0 - Voltar ao menu");
        Console.Write("\nSua escolha: ");

        if (!int.TryParse(Console.ReadLine(), out int escolha))
        {
            DesafioAlgoritmo.Demo.InterfaceConsole.MostrarErro("Op√ß√£o inv√°lida!");
            continue;
        }

        Console.WriteLine();

        switch (escolha)
        {
            case 0:
                return;

            case 1: // Criar
                Console.Write("Mensagem: ");
                var mensagem = Console.ReadLine();
                Console.Write("Status (Pendente/EmAndamento/Concluido): ");
                var status = Console.ReadLine();

                if (string.IsNullOrWhiteSpace(mensagem))
                {
                    DesafioAlgoritmo.Demo.InterfaceConsole.MostrarErro("Mensagem n√£o pode ser vazia!");
                    break;
                }

                // Validar status
                var statusValido = DesafioAlgoritmo.Demo.InterfaceConsole.ValidarStatus(status);
                if (statusValido == null)
                {
                    DesafioAlgoritmo.Demo.InterfaceConsole.MostrarErro("Status inv√°lido! Use: Pendente, EmAndamento ou Concluido");
                    break;
                }

                await repository.AdicionarAsync(new RegistroTrabalho
                {
                    Data = DateTime.Now,
                    Mensagem = mensagem!,
                    Status = statusValido
                });

                Console.WriteLine("\n‚úÖ Registro criado com sucesso!");
                break;

            case 2: // Listar todos
                var todos = await repository.ObterTodosAsync();
                Console.WriteLine($"üìã Total: {todos.Count} registro(s)\n");

                if (todos.Count == 0)
                {
                    Console.WriteLine("‚ÑπÔ∏è  Nenhum registro encontrado.");
                }
                else
                {
                    foreach (var log in todos)
                    {
                        Console.WriteLine($"‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ");
                        Console.WriteLine($"ID: {log.Id}");
                        Console.WriteLine($"Data: {log.Data:dd/MM/yyyy HH:mm}");
                        Console.WriteLine($"Status: {log.Status}");
                        Console.WriteLine($"Mensagem: {log.Mensagem}");
                    }
                    Console.WriteLine($"‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ");
                }
                break;

            case 3: // Buscar por status
                Console.Write("Status para buscar (Pendente/EmAndamento/Concluido): ");
                var statusBusca = Console.ReadLine();

                if (string.IsNullOrWhiteSpace(statusBusca))
                {
                    DesafioAlgoritmo.Demo.InterfaceConsole.MostrarErro("Status n√£o pode ser vazio!");
                    break;
                }

                var statusValidoBusca = DesafioAlgoritmo.Demo.InterfaceConsole.ValidarStatus(statusBusca);
                if (statusValidoBusca == null)
                {
                    DesafioAlgoritmo.Demo.InterfaceConsole.MostrarErro("Status inv√°lido! Use: Pendente, EmAndamento ou Concluido");
                    break;
                }

                var encontrados = await repository.ObterPorStatusAsync(statusValidoBusca);
                Console.WriteLine($"\nüìã Encontrados: {encontrados.Count} registro(s) com status '{statusValidoBusca}'\n");

                foreach (var log in encontrados)
                {
                    Console.WriteLine($"  ‚Ä¢ ID {log.Id}: {log.Mensagem} ({log.Data:dd/MM HH:mm})");
                }
                break;

            case 4: // Atualizar
                Console.Write("ID do registro para atualizar: ");
                if (!int.TryParse(Console.ReadLine(), out int idAtualizar))
                {
                    DesafioAlgoritmo.Demo.InterfaceConsole.MostrarErro("ID inv√°lido!");
                    break;
                }

                var logAtualizar = await repository.ObterPorIdAsync(idAtualizar);
                if (logAtualizar == null)
                {
                    DesafioAlgoritmo.Demo.InterfaceConsole.MostrarErro($"Registro com ID {idAtualizar} n√£o encontrado!");
                    break;
                }

                Console.WriteLine($"Registro atual: {logAtualizar.Mensagem} [{logAtualizar.Status}]");
                Console.Write("Nova mensagem (Enter para manter): ");
                var novaMensagem = Console.ReadLine();
                Console.Write("Novo status (Pendente/EmAndamento/Concluido, Enter para manter): ");
                var novoStatus = Console.ReadLine();

                if (!string.IsNullOrWhiteSpace(novaMensagem))
                    logAtualizar.Mensagem = novaMensagem;

                if (!string.IsNullOrWhiteSpace(novoStatus))
                {
                    var statusValidoAtualizar = DesafioAlgoritmo.Demo.InterfaceConsole.ValidarStatus(novoStatus);
                    if (statusValidoAtualizar == null)
                    {
                        DesafioAlgoritmo.Demo.InterfaceConsole.MostrarErro("Status inv√°lido! Use: Pendente, EmAndamento ou Concluido. Registro n√£o atualizado.");
                        break;
                    }
                    logAtualizar.Status = statusValidoAtualizar;
                }

                await repository.AtualizarAsync(logAtualizar);
                Console.WriteLine("\n‚úÖ Registro atualizado com sucesso!");
                break;

            case 5: // Deletar
                Console.Write("ID do registro para deletar: ");
                if (!int.TryParse(Console.ReadLine(), out int idDeletar))
                {
                    DesafioAlgoritmo.Demo.InterfaceConsole.MostrarErro("ID inv√°lido!");
                    break;
                }

                var deletado = await repository.DeletarAsync(idDeletar);
                if (deletado)
                    Console.WriteLine("\n‚úÖ Registro deletado com sucesso!");
                else
                    DesafioAlgoritmo.Demo.InterfaceConsole.MostrarErro($"Registro com ID {idDeletar} n√£o encontrado!");
                break;

            default:
                DesafioAlgoritmo.Demo.InterfaceConsole.MostrarErro("Op√ß√£o inv√°lida!");
                break;
        }

        Console.WriteLine();
    }
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// SE√á√ÉO 6 - HTTP CLIENT RESILIENTE (COM OBSERVABILIDADE INTEGRADA)
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

async Task TestarClienteHttpResiliente()
{
    bool continuarSubmenu = true;
    TimeSpan timeoutPersonalizado = TimeSpan.FromSeconds(30); // Padr√£o 30s (mant√©m valor entre itera√ß√µes)

    while (continuarSubmenu)
    {
        Console.Clear();
        Console.WriteLine("‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó");
        Console.WriteLine("‚ïë     SE√á√ÉO 4.2 - CLIENTE HTTP RESILIENTE (POLLY)         ‚ïë");
        Console.WriteLine("‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù\n");

        Console.WriteLine("üìù Demonstra cliente HTTP com retry resiliente usando Polly.\n");

        Console.WriteLine("üí° CONFIGURA√á√ÉO ATUAL:");
        Console.WriteLine("   ‚Ä¢ Retry: 3 tentativas (4 tentativas totais)");
        Console.WriteLine("   ‚Ä¢ Backoff exponencial: 1s, 2s, 4s");
        Console.WriteLine($"   ‚Ä¢ Timeout: {timeoutPersonalizado.TotalSeconds}s POR TENTATIVA (use op√ß√£o 5 para alterar)");
        Console.WriteLine("   ‚Ä¢ Retry em: 5xx, 408, network errors");
        Console.WriteLine($"   ‚Ä¢ Tempo m√°ximo total: ~{timeoutPersonalizado.TotalSeconds * 4 + 7}s (4 tentativas + delays)\n");

        Console.WriteLine("üéØ CEN√ÅRIOS DE TESTE:\n");
        Console.WriteLine("  1 - Sucesso imediato (API que responde OK)");
        Console.WriteLine("  2 - Falha com retry (simula 503 ‚Üí 503 ‚Üí 200)");
        Console.WriteLine("  3 - Falha completa (simula 500 em todas tentativas)");
        Console.WriteLine("  4 - Timeout (URL que demora muito)");
        Console.WriteLine("  5 - Configurar timeout customizado");
        Console.WriteLine("  0 - Voltar ao menu principal\n");

        Console.Write("Escolha um cen√°rio: ");
        if (!int.TryParse(Console.ReadLine(), out int cenario) || cenario < 0 || cenario > 5)
        {
            DesafioAlgoritmo.Demo.InterfaceConsole.MostrarErro("Op√ß√£o inv√°lida!");
            Console.WriteLine("Pressione qualquer tecla para continuar...");
            Console.ReadKey(true);
            continue;
        }

        if (cenario == 0)
        {
            continuarSubmenu = false;
            continue;
        }

        // Op√ß√£o para configurar timeout customizado
        if (cenario == 5)
        {
            Console.WriteLine("\n‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó");
            Console.WriteLine("‚ïë           CONFIGURAR TIMEOUT POR TENTATIVA               ‚ïë");
            Console.WriteLine("‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù\n");

            Console.WriteLine("üìñ COMO FUNCIONA:");
            Console.WriteLine("   ‚Ä¢ Timeout √© aplicado POR TENTATIVA individual");
            Console.WriteLine("   ‚Ä¢ Cada retry tem seu pr√≥prio timeout");
            Console.WriteLine("   ‚Ä¢ Delays entre retries: 1s, 2s, 4s\n");

            Console.WriteLine("üí° EXEMPLO:");
            Console.WriteLine("   Timeout configurado: 10s");
            Console.WriteLine("   ‚îú‚îÄ Tentativa 1: at√© 10s");
            Console.WriteLine("   ‚îú‚îÄ Delay: 1s");
            Console.WriteLine("   ‚îú‚îÄ Tentativa 2: at√© 10s");
            Console.WriteLine("   ‚îú‚îÄ Delay: 2s");
            Console.WriteLine("   ‚îú‚îÄ Tentativa 3: at√© 10s");
            Console.WriteLine("   ‚îú‚îÄ Delay: 4s");
            Console.WriteLine("   ‚îî‚îÄ Tentativa 4: at√© 10s");
            Console.WriteLine("   ");
            Console.WriteLine("   Tempo m√°ximo total: (10s √ó 4) + (1s + 2s + 4s) = ~47s\n");

            Console.ForegroundColor = ConsoleColor.Yellow;
            Console.WriteLine($"‚ö†Ô∏è  Timeout atual: {timeoutPersonalizado.TotalSeconds}s por tentativa");
            Console.ResetColor();

            Console.Write("\n‚è±Ô∏è  Digite o novo timeout em segundos (Enter para manter): ");
            var input = Console.ReadLine();

            if (!string.IsNullOrWhiteSpace(input))
            {
                if (int.TryParse(input, out int timeoutSegundos) && timeoutSegundos > 0)
                {
                    timeoutPersonalizado = TimeSpan.FromSeconds(timeoutSegundos);
                    var tempoMaximo = (timeoutSegundos * 4) + 7;

                    Console.ForegroundColor = ConsoleColor.Green;
                    Console.WriteLine($"\n‚úÖ Timeout configurado para {timeoutSegundos}s por tentativa");
                    Console.ResetColor();
                    Console.WriteLine($"üìä Tempo m√°ximo total (pior caso): ~{tempoMaximo}s");
                    Console.WriteLine($"   ‚îî‚îÄ ({timeoutSegundos}s √ó 4 tentativas) + (7s de delays)");
                }
                else
                {
                    DesafioAlgoritmo.Demo.InterfaceConsole.MostrarErro("Timeout inv√°lido! Mantendo configura√ß√£o anterior.");
                }
            }
            else
            {
                Console.WriteLine($"‚ÑπÔ∏è  Mantendo timeout de {timeoutPersonalizado.TotalSeconds}s");
            }

            Console.WriteLine("\nPressione qualquer tecla para voltar ao menu...");
            Console.ReadKey(true);
            continue;
        }

        using var scope = serviceProvider.CreateScope();
        var httpClientFactory = scope.ServiceProvider.GetRequiredService<IHttpClientFactory>();
        var httpClient = httpClientFactory.CreateClient(nameof(ClienteHttpResistente));
        var logger = scope.ServiceProvider.GetRequiredService<ILogger<ClienteHttpResistente>>();
        var metricas = scope.ServiceProvider.GetRequiredService<MetricasAplicacao>();
        var cliente = new ClienteHttpResistente(httpClient, logger, metricas, timeoutPersonalizado);

        Console.WriteLine("\n‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó");
        Console.ForegroundColor = ConsoleColor.Cyan;
        Console.WriteLine("‚ïë  üîç OBSERVABILIDADE ATIVA                                 ‚ïë");
        Console.ResetColor();
        Console.WriteLine("‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù");
        Console.WriteLine("üìä M√©tricas sendo coletadas:");
        Console.WriteLine("   ‚Ä¢ Tempo de cada tentativa HTTP");
        Console.WriteLine("   ‚Ä¢ Contagem de retries (Polly)");
        Console.WriteLine("   ‚Ä¢ Sucesso/erro por opera√ß√£o");
        Console.WriteLine("   ‚Ä¢ Correla√ß√£o via OperationId");
        Console.WriteLine();

    try
    {
        switch (cenario)
        {
            case 1: // Sucesso
                Console.WriteLine("üîÑ Testando API que responde com sucesso...\n");
                Console.WriteLine("üìç URL: https://httpbin.org/status/200");
                Console.WriteLine("   (Servi√ßo real que sempre retorna 200 OK)\n");

                var response1 = await cliente.ObterAsync("https://httpbin.org/status/200");

                Console.WriteLine("\n‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê");

                if (response1.IsSuccessStatusCode)
                {
                    Console.ForegroundColor = ConsoleColor.Green;
                    Console.WriteLine($"‚úÖ SUCESSO na primeira tentativa!");
                    Console.ResetColor();
                    Console.WriteLine($"üìä Status Code: {response1.StatusCode} ({(int)response1.StatusCode})");
                    Console.WriteLine($"‚è±Ô∏è  Sem retries necess√°rios");
                    Console.WriteLine($"\nüí° API respondeu imediatamente com sucesso!");
                    Console.WriteLine($"   Nenhum retry foi necess√°rio.");
                }
                else
                {
                    Console.ForegroundColor = ConsoleColor.Red;
                    Console.WriteLine($"‚ùå ERRO INESPERADO!");
                    Console.ResetColor();
                    Console.WriteLine($"üìä Status Code: {response1.StatusCode} ({(int)response1.StatusCode})");
                    Console.WriteLine($"\n‚ö†Ô∏è  A API deveria retornar 200, mas retornou {response1.StatusCode}!");
                }
                Console.WriteLine("‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê");
                break;

            case 2: // Retry - demonstra tentativas
                Console.WriteLine("üîÑ Testando retry com erro 503 (Service Unavailable)...\n");
                Console.WriteLine("üìç URL: https://httpbin.org/status/503");
                Console.WriteLine("   (API que sempre retorna 503 para demonstrar retry)\n");
                Console.WriteLine("‚ö†Ô∏è  OBSERVE nos logs acima:");
                Console.WriteLine("   Voc√™ ver√° 'Retry 1', 'Retry 2', 'Retry 3'");
                Console.WriteLine("   Com delays de 1s, 2s, 4s (backoff exponencial)\n");

                var response2 = await cliente.ObterAsync("https://httpbin.org/status/503");

                Console.WriteLine("\n‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê");
                Console.ForegroundColor = ConsoleColor.Yellow;
                Console.WriteLine($"‚ö†Ô∏è  API RETORNOU ERRO AP√ìS 4 TENTATIVAS");
                Console.ResetColor();
                Console.WriteLine($"üìä Status Code: {response2.StatusCode} ({(int)response2.StatusCode})");
                Console.WriteLine($"\nüí° O que aconteceu:");
                Console.WriteLine($"   ‚úì Tentativa 1: 503 Service Unavailable");
                Console.WriteLine($"   ‚úì Aguardou 1 segundo (backoff)");
                Console.WriteLine($"   ‚úì Tentativa 2: 503 Service Unavailable");
                Console.WriteLine($"   ‚úì Aguardou 2 segundos (backoff)");
                Console.WriteLine($"   ‚úì Tentativa 3: 503 Service Unavailable");
                Console.WriteLine($"   ‚úì Aguardou 4 segundos (backoff)");
                Console.WriteLine($"   ‚úì Tentativa 4: 503 Service Unavailable ‚Üí Desistiu");
                Console.WriteLine($"\n‚è±Ô∏è  Total: ~7 segundos de retries");
                Console.WriteLine($"\nüìñ Isso demonstra que o Polly est√° funcionando!");
                Console.WriteLine($"   Ele fez 3 retries com backoff exponencial como configurado.");
                Console.WriteLine("‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê");
                break;

            case 3: // Falha completa
                Console.WriteLine("üîÑ Testando erro permanente (500 Internal Server Error)...\n");
                Console.WriteLine("üìç URL: https://httpbin.org/status/500\n");

                try
                {
                    var response3 = await cliente.ObterAsync("https://httpbin.org/status/500");
                }
                catch (Exception ex)
                {
                    Console.WriteLine("\n‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê");
                    Console.ForegroundColor = ConsoleColor.Red;
                    Console.WriteLine("‚ùå FALHA PERMANENTE (mesmo ap√≥s retries)");
                    Console.ResetColor();
                    Console.WriteLine($"\nüí° O Polly tentou 4 vezes:");
                    Console.WriteLine($"   ‚Ä¢ Original + 3 retries");
                    Console.WriteLine($"   ‚Ä¢ Delays: 1s, 2s, 4s");
                    Console.WriteLine($"   ‚Ä¢ Total: ~7 segundos");
                    Console.WriteLine($"\nüìä Erro: {ex.GetType().Name}");
                    Console.WriteLine($"üí¨ Mensagem: Servidor retornou 500 em todas tentativas");
                    Console.WriteLine("‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê");
                }
                break;

            case 4: // Timeout
                Console.WriteLine("üîÑ Testando timeout (URL que demora 15 segundos)...\n");
                Console.WriteLine("üìç URL: https://httpbin.org/delay/15");
                Console.WriteLine("   (Servidor espera 15s antes de responder)\n");

                Console.WriteLine("‚öôÔ∏è  CONFIGURA√á√ÉO:");
                Console.WriteLine($"   ‚Ä¢ Timeout: {timeoutPersonalizado.TotalSeconds}s POR TENTATIVA");
                Console.WriteLine($"   ‚Ä¢ Retries: 3 (4 tentativas totais)");
                Console.WriteLine($"   ‚Ä¢ Tempo m√°ximo: ~{(timeoutPersonalizado.TotalSeconds * 4) + 7}s\n");

                if (timeoutPersonalizado.TotalSeconds >= 15)
                {
                    Console.ForegroundColor = ConsoleColor.Green;
                    Console.WriteLine($"‚úÖ Timeout ({timeoutPersonalizado.TotalSeconds}s) > Delay do servidor (15s)");
                    Console.ResetColor();
                    Console.WriteLine("   Primeira tentativa deve ter SUCESSO!\n");
                }
                else
                {
                    Console.ForegroundColor = ConsoleColor.Yellow;
                    Console.WriteLine($"‚ö†Ô∏è  Timeout ({timeoutPersonalizado.TotalSeconds}s) < Delay do servidor (15s)");
                    Console.ResetColor();
                    Console.WriteLine("   Todas as 4 tentativas v√£o dar TIMEOUT!");
                    Console.WriteLine($"   Tempo total: ~{(timeoutPersonalizado.TotalSeconds * 4) + 7}s\n");
                    Console.WriteLine("üí° TIP: Use op√ß√£o 5 para configurar timeout >= 16s\n");
                }

                try
                {
                    var response4 = await cliente.ObterAsync("https://httpbin.org/delay/15");

                    Console.WriteLine("\n‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê");
                    Console.ForegroundColor = ConsoleColor.Green;
                    Console.WriteLine("‚úÖ SUCESSO - Servidor respondeu dentro do timeout!");
                    Console.ResetColor();
                    Console.WriteLine($"üìä Status Code: {response4.StatusCode}");
                    Console.WriteLine($"\nüí° O que aconteceu:");
                    Console.WriteLine($"   ‚Ä¢ Servidor demorou 15s para responder");
                    Console.WriteLine($"   ‚Ä¢ Timeout de {timeoutPersonalizado.TotalSeconds}s foi suficiente");
                    Console.WriteLine($"   ‚Ä¢ Sucesso na primeira tentativa (sem retries necess√°rios)");
                    Console.WriteLine("‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê");
                }
                catch (Exception ex)
                {
                    Console.WriteLine("\n‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê");
                    Console.ForegroundColor = ConsoleColor.Red;
                    Console.WriteLine($"‚ùå TODAS AS 4 TENTATIVAS FALHARAM POR TIMEOUT");
                    Console.ResetColor();
                    Console.WriteLine($"\nüí° O que aconteceu:");
                    Console.WriteLine($"   ‚Ä¢ Tentativa 1: Timeout ap√≥s {timeoutPersonalizado.TotalSeconds}s");
                    Console.WriteLine($"   ‚Ä¢ Aguardou 1s (backoff)");
                    Console.WriteLine($"   ‚Ä¢ Tentativa 2: Timeout ap√≥s {timeoutPersonalizado.TotalSeconds}s");
                    Console.WriteLine($"   ‚Ä¢ Aguardou 2s (backoff)");
                    Console.WriteLine($"   ‚Ä¢ Tentativa 3: Timeout ap√≥s {timeoutPersonalizado.TotalSeconds}s");
                    Console.WriteLine($"   ‚Ä¢ Aguardou 4s (backoff)");
                    Console.WriteLine($"   ‚Ä¢ Tentativa 4: Timeout ap√≥s {timeoutPersonalizado.TotalSeconds}s ‚Üí Desistiu");

                    var tempoTotal = (timeoutPersonalizado.TotalSeconds * 4) + 7;
                    Console.WriteLine($"\n‚è±Ô∏è  Tempo total gasto: ~{tempoTotal}s");
                    Console.WriteLine($"   ‚îî‚îÄ ({timeoutPersonalizado.TotalSeconds}s √ó 4) + (1s + 2s + 4s)");

                    Console.WriteLine($"\nüìä An√°lise:");
                    Console.WriteLine($"   ‚Ä¢ Servidor precisa de 15s para responder");
                    Console.WriteLine($"   ‚Ä¢ Seu timeout est√° em {timeoutPersonalizado.TotalSeconds}s por tentativa");
                    Console.WriteLine($"   ‚Ä¢ {timeoutPersonalizado.TotalSeconds}s < 15s ‚Üí Nunca vai dar certo!");

                    Console.WriteLine($"\nüìä Erro: {ex.GetType().Name}");
                    Console.WriteLine($"üí¨ Mensagem: {ex.Message}");

                    Console.WriteLine($"\nüí° SOLU√á√ÉO:");
                    Console.WriteLine($"   Use op√ß√£o 5 para configurar timeout >= 16s");
                    Console.WriteLine($"   Exemplo: timeout de 20s ‚Üí Sucesso na 1¬™ tentativa!");
                    Console.WriteLine("‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê");
                }
                break;
        }
    }
    catch (Exception ex)
    {
        DesafioAlgoritmo.Demo.InterfaceConsole.MostrarErro($"Erro inesperado: {ex.Message}");
    }

        Console.WriteLine($"\n\n‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó");
        Console.WriteLine($"‚ïë                    RESUMO T√âCNICO                         ‚ïë");
        Console.WriteLine($"‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù\n");

        Console.WriteLine($"üìä CONFIGURA√á√ÉO POLLY:");
        Console.WriteLine($"   ‚Ä¢ Retries: 3 (4 tentativas totais: 1 original + 3 retries)");
        Console.WriteLine($"   ‚Ä¢ Backoff exponencial: 1s ‚Üí 2s ‚Üí 4s");
        Console.WriteLine($"   ‚Ä¢ Retry em: 5xx, 408, network errors, timeout");
        Console.WriteLine($"   ‚Ä¢ Timeout: {timeoutPersonalizado.TotalSeconds}s POR TENTATIVA");

        var tempoMaximoTotal = (timeoutPersonalizado.TotalSeconds * 4) + 7;
        Console.WriteLine($"\n‚è±Ô∏è  C√ÅLCULO DE TEMPO:");
        Console.WriteLine($"   ‚Ä¢ Timeout por tentativa: {timeoutPersonalizado.TotalSeconds}s");
        Console.WriteLine($"   ‚Ä¢ Total de tentativas: 4");
        Console.WriteLine($"   ‚Ä¢ Delays entre retries: 1s + 2s + 4s = 7s");
        Console.WriteLine($"   ‚Ä¢ Tempo m√°ximo poss√≠vel: ~{tempoMaximoTotal}s");
        Console.WriteLine($"     ‚îî‚îÄ ({timeoutPersonalizado.TotalSeconds}s √ó 4) + 7s");

        Console.WriteLine($"\nüí° IMPORTANTE:");
        Console.WriteLine($"   ‚Ä¢ Timeout √© POR TENTATIVA, n√£o global");
        Console.WriteLine($"   ‚Ä¢ Se API demora 15s, timeout deve ser >= 16s");
        Console.WriteLine($"   ‚Ä¢ Retry funciona para erros transit√≥rios (conex√£o, 5xx)");
        Console.WriteLine($"   ‚Ä¢ Timeout n√£o resolve problema de API lenta");

        Console.WriteLine($"\nüìñ Ver ANALISE_RETRY_POLLY.md para detalhes completos!");

        Console.WriteLine();
        Console.ForegroundColor = ConsoleColor.Cyan;
        Console.WriteLine("üìà M√âTRICAS REGISTRADAS:");
        Console.ResetColor();
        Console.WriteLine($"   ‚úÖ Opera√ß√£o: ClienteHttpResistente.ObterAsync");
        Console.WriteLine($"   ‚è±Ô∏è  Timeout por tentativa: {timeoutPersonalizado.TotalSeconds}s");
        Console.WriteLine($"   üîÅ Retries executados: Veja logs acima");
        Console.WriteLine($"   üîó Logs com correla√ß√£o via OperationId");
        Console.ForegroundColor = ConsoleColor.Green;
        Console.WriteLine("üí° Veja os logs acima - todos t√™m [IdOperacao=...] para correla√ß√£o!");
        Console.ResetColor();

        Console.WriteLine("\n\nPressione qualquer tecla para voltar ao menu de HTTP Client...");
        Console.ReadKey(true);
    }
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// FUN√á√ïES AUXILIARES
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

void MostrarMenuPrincipal()
{
    Console.WriteLine("‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó");
    Console.WriteLine("‚ïë        DESAFIO T√âCNICO - ALGORITMOS E BACKEND            ‚ïë");
    Console.WriteLine("‚ïë              Demonstra√ß√£o Interativa                      ‚ïë");
    Console.WriteLine("‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù\n");

    Console.WriteLine("üìö SE√á√ïES DISPON√çVEIS:\n");
    Console.WriteLine("  1Ô∏è‚É£  Algoritmo: Primeiro N√∫mero Repetido");
    Console.WriteLine("      ‚îî‚îÄ Encontra primeira duplicata em O(n)");
    Console.WriteLine();
    Console.WriteLine("  2Ô∏è‚É£  Algoritmo: Maior Sequ√™ncia Crescente");
    Console.WriteLine("      ‚îî‚îÄ Encontra maior subsequ√™ncia em O(n)");
    Console.WriteLine();
    Console.WriteLine("  3Ô∏è‚É£  Concorr√™ncia: Processamento Paralelo");
    Console.WriteLine("      ‚îî‚îÄ Thread-safe + M√©tricas + Correla√ß√£o");
    Console.WriteLine();
    Console.WriteLine("  4Ô∏è‚É£  Design: Orquestrador com Tratamento de Erros");
    Console.WriteLine("      ‚îî‚îÄ Respostas parciais + Observabilidade");
    Console.WriteLine();
    Console.WriteLine("  5Ô∏è‚É£  Persist√™ncia: Entity Framework Core");
    Console.WriteLine("      ‚îî‚îÄ CRUD completo + M√©tricas de performance");
    Console.WriteLine();
    Console.WriteLine("  6Ô∏è‚É£  HTTP Client Resiliente: Polly + Retry");
    Console.WriteLine("      ‚îî‚îÄ Retry com backoff + M√©tricas + Correla√ß√£o");
    Console.WriteLine();
    Console.WriteLine("  7Ô∏è‚É£  Sair");
    Console.WriteLine();
    Console.ForegroundColor = ConsoleColor.Cyan;
    Console.WriteLine("üí° Observabilidade integrada em TODAS as op√ß√µes!");
    Console.ResetColor();
    Console.WriteLine("   ‚Ä¢ M√©tricas de tempo e taxa de erro");
    Console.WriteLine("   ‚Ä¢ Correla√ß√£o via OperationId");
    Console.WriteLine("   ‚Ä¢ Logs estruturados com contexto");
    Console.WriteLine("\n‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ");
}
